# Description

The following is a general research dump on a few different aspects of payments via the Lightning Network


## Lightning Invoices

At a high level the lightning network works by passing payments along a route of channels until it gets from sender to recipient. The payments are routed in an atomic way, meaning that, the payment either gets all the way to the recipient or it fails completely. This means that payments can't get stuck or stolen at any point in the routing from sender to recipient.

### The Standard Invoice

Payments are made via invoices that are generated by the recipient and sent to the sender via some out of band method (QR code, text message etc.).

_[Note: The following describes the technical bits relevant [for routing](https://github.com/lnbook/lnbook/blob/adbd2efbad97323c587fb3c6efee7ebd03392993/routing.asciidoc). We should probably include notes on the other elements of an invoice as well e.g. amount, recipient node id, description etc.]_

Invoices are made up of a few different pieces of information, but the two critical bits that we are usually concerned with are:
1. The payment hash, and
1. The payment preimage

#### Payment hash
Think of this as a single blob that acts as a fingerprint for the invoice. Each payment hash is unique and can only ever correspond to a single generated invoice. The payment hash is created by the recipient and given to the sender (it is contained in the invoice). It is used by the sender to start the process of sending the funds across to the recipient across the Lightning Network.

#### Payment preimage
Think of this as the receipt that is provided on successful delivery of a payment. This receipt is held secretly by the recipient and only revealed on receipt of the payment that comes in across the network.

_**Important:** if this secret is revealed before the payment is received, other participants in the network involved in routing this particular payment can steal the funds en route before it gets to its destination. This could be done by passing the receipt (preimage) back up the chain without sending the payment forward to the recipient._

--

**_Links:_**
- _Technical breakdown of a Lightning Invoice: https://medium.com/suredbits/lightning-101-what-is-a-lightning-invoice-d527db1a77e6_
- _Required fields for a Lightning Invoice: https://btcmanager.com/brief-guide-how-create-lightning-network-invoices/_

### The HODL Invoice
...

---

### 1. Notes on `key send`

- Uses “sphinx packets”?
    - https://github.com/lightningnetwork/lightning-onion/pull/40
    - https://wiki.ion.radar.tech/tech/lightning/sphinx-packet)


- Used to be called `sphinx send`
    -https://wiki.ion.radar.tech/tech/research/sphinx-send


 - `--data` flag for sending along data as well (needs `record=hexvalue`)

- tlv data records + keysend open up some interesting possibilities
    - https://twitter.com/joostjgr/status/1234896447038017537


---

### 2. Notes on `hodl invoices`


- Pretty much a normal send except the receiver holds the preimage and settles later
    - The payment is split into a "send" step (by the sender) and an "settle" step (by the receiver)
    - Limit of 483 open invoices can be routed at any given time by a node (something about on-chain transaction size limit? https://bitcoin.stackexchange.com/a/91169)

- Collection of different real-world scenarios here
    - https://github.com/lightningnetwork/lnd/pull/2022
    - https://wiki.ion.radar.tech/tech/research/hodl-invoice


- Somehow allows for keysend?
    - https://github.com/lightningnetwork/lnd/pull/2455
    - https://github.com/lightningnetwork/lnd/pull/3795


- Allows for MPP
    - https://wiki.ion.radar.tech/tech/research/hodl-invoice#atomic-multi-party-item-delivery-payment
    - https://lightning.engineering/posts/2020-05-07-mpp/
    - https://github.com/lightningnetwork/lnd/pull/3967

- Submarine swap variant
    - https://wiki.ion.radar.tech/tech/research/hodl-invoice#submarine-swap-variation


---
### 3. Notes on `submarine swaps` (automated Lightning Pool etc.)

- ...